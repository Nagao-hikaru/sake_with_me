 <div id="target"></div>
 <style>
    #target {
      width: 550px;
      height: 200px;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
  
<script>
  // var map;
  // function initMap() {
  //   var target = document.getElementById('target');
  //   var empire = {lat: 40.748441, lng: -73.985664};
  //   var tokyo = {lat: 35.681167, lng: 139.767052};
  //   var skytree = {lat: 35.7100069, lng: 139.8108103}

  //   map = new google.maps.Map(target, {
  //     center: tokyo,
  //     zoom: 14
  //   });

  //   var infoWindow = new google.maps.InfoWindow; 
  

  //   if(!navigator.geolocation){ 
  //     infoWindow.setPosition(map.getCenter());
  //     infoWindow.setContent('Geolocation に対応していません。');
  //     infoWindow.open(map);
  //   }

  //   navigator.geolocation.getCurrentPosition(function(position){
  //     var pos = {
  //       lat: position.coords.latitude,
  //       lng: position.coords.longitude
  //     };
  //   })
  //   console.log(pos)

  //   let directionsService = new google.maps.DirectionsService();
  //   let directionsRenderer = new google.maps.DirectionsRenderer();
  //   directionsRenderer.setMap(map);

  //   var request = {
  //     origin: pos,
  //     destination: "大阪城ホール",
  //     travelMode: 'WALKING'
  //   }
  //   directionsService.route(request, function(result, status) {

  //   if (status === 'OK') {
  //     directionsRenderer.setDirections(result); 
  //   }else{
  //     alert("取得できませんでした：" + status);
  //   }
  //   });
  //   };

    function initMap() {
  var target = document.getElementById('target');  
   var tokyo = {lat: 35.681167, lng: 139.767052};

  var map = new google.maps.Map(document.getElementById('target'), {
    center: tokyo,
    zoom: 15
  });

  var infoWindow = new google.maps.InfoWindow; 
  
  if(!navigator.geolocation){ 

    infoWindow.setPosition(map.getCenter());

    infoWindow.setContent('Geolocation に対応していません。');

    infoWindow.open(map);
  }
  

  navigator.geolocation.getCurrentPosition(function(position) { 

    var pos = {  
      lat: position.coords.latitude,
      lng: position.coords.longitude
    };
    

    var directionsService = new google.maps.DirectionsService();
    var directionsRenderer = new google.maps.DirectionsRenderer();
    directionsRenderer.setMap(map);  
 

    var request = {
      origin: pos,      
      destination: "大阪城ホール",   
      travelMode: 'WALKING'  
    };
    
    directionsService.route(request, function(result, status) {
      if (status === 'OK') {
        directionsRenderer.setDirections(result);
      }else{
        alert("取得できませんでした：" + status);
      }
    });
    
  }, function() { 
    infoWindow.setPosition(map.getCenter());
    infoWindow.setContent('Error: 位置情報を許可しないと反映されません。');
    infoWindow.open(map);
  });   
}
</script> 



